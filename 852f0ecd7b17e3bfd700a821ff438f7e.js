ace.define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],(function(e,t,r){"use strict";var a=e("../token_iterator").TokenIterator;function is(e,t){return e.type.lastIndexOf(t+".xml")>-1}t.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],t.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],t.formatOptions={lineBreaksAfterCommasInCurlyBlock:!0},t.beautify=function(e){for(var r,s,o,i=new a(e,0,0),n=i.getCurrentToken(),c=e.getTabString(),l=t.singletonTags,m=t.blockTags,u=t.formatOptions||{},p=!1,f=!1,h=!1,y="",d="",g="",b=0,k=0,$=0,w=0,v=0,x=0,T=0,C=0,R=0,B=!1,O=!1,I=!1,q=!1,_={0:0},j=[],A=!1,trimNext=function(){r&&r.value&&"string.regexp"!==r.type&&(r.value=r.value.replace(/^\s*/,""))},trimLine=function(){for(var e=y.length-1;0!=e&&" "===y[e];)e-=1;y=y.slice(0,e+1)},trimCode=function(){y=y.trimRight(),p=!1};null!==n;){if(C=i.getCurrentTokenRow(),i.$rowTokens,r=i.stepForward(),void 0!==n){if(d=n.value,v=0,I="style"===g||"ace/mode/css"===e.$modeId,is(n,"tag-open")?(O=!0,r&&(q=-1!==m.indexOf(r.value)),"</"===d&&(q&&!p&&R<1&&R++,I&&(R=1),v=1,q=!1)):is(n,"tag-close")?O=!1:is(n,"comment.start")?q=!0:is(n,"comment.end")&&(q=!1),O||R||"paren.rparen"!==n.type||"}"!==n.value.substr(0,1)||R++,C!==s&&(R=C,s&&(R-=s)),R){for(trimCode();R>0;R--)y+="\n";p=!0,is(n,"comment")||n.type.match(/^(comment|string)$/)||(d=d.trimLeft())}if(d){if("keyword"===n.type&&d.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(j[b]=d,trimNext(),h=!0,d.match(/^(else|elseif)$/)&&y.match(/\}[\s]*$/)&&(trimCode(),f=!0)):"paren.lparen"===n.type?(trimNext(),"{"===d.substr(-1)&&(h=!0,B=!1,O||(R=1)),"{"===d.substr(0,1)&&(f=!0,"["!==y.substr(-1)&&"["===y.trimRight().substr(-1)?(trimCode(),f=!1):")"===y.trimRight().substr(-1)?trimCode():trimLine())):"paren.rparen"===n.type?(v=1,"}"===d.substr(0,1)&&("case"===j[b-1]&&v++,"{"===y.trimRight().substr(-1)?trimCode():(f=!0,I&&(R+=2))),"]"===d.substr(0,1)&&"}"!==y.substr(-1)&&"}"===y.trimRight().substr(-1)&&(f=!1,w++,trimCode()),")"===d.substr(0,1)&&"("!==y.substr(-1)&&"("===y.trimRight().substr(-1)&&(f=!1,w++,trimCode()),trimLine()):"keyword.operator"!==n.type&&"keyword"!==n.type||!d.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===n.type&&";"===d?(trimCode(),trimNext(),h=!0,I&&R++):"punctuation.operator"===n.type&&d.match(/^(:|,)$/)?(trimCode(),trimNext(),d.match(/^(,)$/)&&T>0&&0===x&&u.lineBreaksAfterCommasInCurlyBlock?R++:(h=!0,p=!1)):"support.php_tag"!==n.type||"?>"!==d||p?is(n,"attribute-name")&&y.substr(-1).match(/^\s$/)?f=!0:is(n,"attribute-equals")?(trimLine(),trimNext()):is(n,"tag-close")?(trimLine(),"/>"===d&&(f=!0)):"keyword"===n.type&&d.match(/^(case|default)$/)&&A&&(v=1):(trimCode(),f=!0):(trimCode(),trimNext(),f=!0,h=!0),p&&(!n.type.match(/^(comment)$/)||d.substr(0,1).match(/^[/#]$/))&&(!n.type.match(/^(string)$/)||d.substr(0,1).match(/^['"@]$/))){if(w=$,b>k)for(w++,o=b;o>k;o--)_[o]=w;else b<k&&(w=_[b]);for(k=b,$=w,v&&(w-=v),B&&!x&&(w++,B=!1),o=0;o<w;o++)y+=c}if("keyword"===n.type&&d.match(/^(case|default)$/)?!1===A&&(j[b]=d,b++,A=!0):"keyword"===n.type&&d.match(/^(break)$/)&&j[b-1]&&j[b-1].match(/^(case|default)$/)&&(b--,A=!1),"paren.lparen"===n.type&&(x+=(d.match(/\(/g)||[]).length,T+=(d.match(/\{/g)||[]).length,b+=d.length),"keyword"===n.type&&d.match(/^(if|else|elseif|for|while)$/)?(B=!0,x=0):!x&&d.trim()&&"comment"!==n.type&&(B=!1),"paren.rparen"===n.type)for(x-=(d.match(/\)/g)||[]).length,T-=(d.match(/\}/g)||[]).length,o=0;o<d.length;o++)b--,"}"===d.substr(o,1)&&"case"===j[b]&&b--;"text"==n.type&&(d=d.replace(/\s+$/," ")),f&&!p&&(trimLine(),"\n"!==y.substr(-1)&&(y+=" ")),y+=d,h&&(y+=" "),p=!1,f=!1,h=!1,(is(n,"tag-close")&&(q||-1!==m.indexOf(g))||is(n,"doctype")&&">"===d)&&(R=q&&r&&"</"===r.value?-1:1),r&&-1===l.indexOf(r.value)&&(is(n,"tag-open")&&"</"===d?b--:is(n,"tag-open")&&"<"===d?b++:is(n,"tag-close")&&"/>"===d&&b--),is(n,"tag-name")&&(g=d),s=C}}n=r}y=y.trim(),e.doc.setValue(y)},t.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(e){t.beautify(e.session)},bindKey:"Ctrl-Shift-B"}]})),ace.require(["ace/ext/beautify"],(function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}));